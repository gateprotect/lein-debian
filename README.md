# lein-debian

A Leiningen plugin to build Debian packages

## Usage

Put `[lein-debian "0.1.0-SNAPSHOT"]` into the `:plugins` vector of your project.clj.

This plugin is capable of both, packaging build products into a Debian package and
packaging a given dependency into a Debian package (for example, to satisfy a 
debian dependency for a given package, that depends on libraries that are not
released as Debian packages, or are not the right version. I'll explain all that
with a series of examples.

Let's say that you have a project named "sprockets". So, you have your usual leiningen
project, and your project.clj might look something like this:

    (defproject snl/sprockets "1.1-SNAPSHOT"
      :description "Now is ze time on Sprockets when ve dance"
      :dependencies [[ com.sun.jna/jna "3.0.9" ]
                     [ ring/ring.core  "1.0.0" ]])

Now let us say you want to package the sprockets library into a Debian package,
you would add the plugin to the project:

      :plugins [[lein-debian "0.1.0-SNAPSHOT"]]

Note, that at this time the plugin is not available on any repositories. So you 
have to clone this repository, build the plugin and install it yourself. Simply
clone this repository and install with "lein install"

Now, to build a Debian package using all the default settings, just type:

      $ lein debian package

If everything goes well, you should have a shiny new debian package under the 
target directory, containing the jar(s) that your build created. This Debian
package will contain dependencies to two other packages, libjna-clojure 3.0.9 and 
libring-core-clojure 1.0.0 (or newer). Now, these Debian dependencies were of
course autogenerated using some default settings you can override. For example
there is a jna package already available from Debian. The automatic dependency to
libjna-clojure is simply not correct. We can override this by adding a :debian key
to the dependency, so:

      :dependencies [[ com.sun.jna/jna "3.0.9" :debian [libjna-java "3.2.7-4"]
                     [ ring/ring.core  "1.0.0" ]])

This way, the Debian dependency for JNA will be overriden to use the standard
package. Note that in this case, it is up to you to make sure that whatever version
you are overriding the dependency with, is indeed compatible and satisfies your 
original dependency.

But now there is another problem. There is simply no libring-core-clojure Debian
package. It is not a standard package. Hmm. Ok. We need to fetch this dependency and 
repackage it ourselves. Simply run:

      $ lein debian repackage ring/ring.core 1.0.0

Note that this doesn't even require a project.clj. It will simply fetch the given
artifact and repackage its files inside a Debian package, that by default will
be called libring-core-clojure. This can be overriden by specifying a :name and/or
:version keys as arguments to the command above. For example, let us suppose the
JNA version that is widely available, is not compatible with our library. No other
choice but to repackage it. However, we want to keep the same naming scheme as Debian
so, we use:

      $ lein debian repackage com.sun.jna/jna "3.0.9" :name libjna-java :version "3.0.9-1"

There are multiple options that can in the project to override default settings:
:deb-section       (defaults to contrib)
:deb-priority      (defaults to optional)
:deb-maintainer    (defaults to the settings in DEBFULLNAME and DEBEMAIL env variables)
:deb-architecture  (defaults to "all")
:deb-files         files to package. Defaults to "*.jar"
:deb-build-depends 
:deb-standards-version
:deb-homepage
## License

Copyright Â© 2012 Erick Gonzalez

Distributed under the Eclipse Public License, the same as Clojure.
